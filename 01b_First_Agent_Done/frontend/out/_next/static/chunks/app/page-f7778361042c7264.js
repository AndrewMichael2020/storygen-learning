(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{1362:(e,t,r)=>{"use strict";r.d(t,{D:()=>i,N:()=>d});var a=r(2115),n=(e,t,r,a,n,s,l,o)=>{let c=document.documentElement,i=["light","dark"];function d(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,a=r&&s?n.map(e=>s[e]||e):n;r?(c.classList.remove(...a),c.classList.add(s&&s[t]?s[t]:t)):c.setAttribute(e,t)}),r=t,o&&i.includes(r)&&(c.style.colorScheme=r)}if(a)d(a);else try{let e=localStorage.getItem(t)||r,a=l&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;d(a)}catch(e){}},s=["light","dark"],l="(prefers-color-scheme: dark)",o=a.createContext(void 0),c={setTheme:e=>{},themes:[]},i=()=>{var e;return null!=(e=a.useContext(o))?e:c},d=e=>a.useContext(o)?a.createElement(a.Fragment,null,e.children):a.createElement(g,{...e}),m=["light","dark"],g=e=>{let{forcedTheme:t,disableTransitionOnChange:r=!1,enableSystem:n=!0,enableColorScheme:c=!0,storageKey:i="theme",themes:d=m,defaultTheme:g=n?"system":"light",attribute:p="data-theme",value:b,children:f,nonce:k,scriptProps:v}=e,[w,N]=a.useState(()=>h(i,g)),[j,S]=a.useState(()=>"system"===w?y():w),E=b?Object.values(b):d,C=a.useCallback(e=>{let t=e;if(!t)return;"system"===e&&n&&(t=y());let a=b?b[t]:t,l=r?x(k):null,o=document.documentElement,i=e=>{"class"===e?(o.classList.remove(...E),a&&o.classList.add(a)):e.startsWith("data-")&&(a?o.setAttribute(e,a):o.removeAttribute(e))};if(Array.isArray(p)?p.forEach(i):i(p),c){let e=s.includes(g)?g:null,r=s.includes(t)?t:e;o.style.colorScheme=r}null==l||l()},[k]),_=a.useCallback(e=>{let t="function"==typeof e?e(w):e;N(t);try{localStorage.setItem(i,t)}catch(e){}},[w]),M=a.useCallback(e=>{S(y(e)),"system"===w&&n&&!t&&C("system")},[w,t]);a.useEffect(()=>{let e=window.matchMedia(l);return e.addListener(M),M(e),()=>e.removeListener(M)},[M]),a.useEffect(()=>{let e=e=>{e.key===i&&(e.newValue?N(e.newValue):_(g))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[_]),a.useEffect(()=>{C(null!=t?t:w)},[t,w]);let A=a.useMemo(()=>({theme:w,setTheme:_,forcedTheme:t,resolvedTheme:"system"===w?j:w,themes:n?[...d,"system"]:d,systemTheme:n?j:void 0}),[w,_,t,j,n,d]);return a.createElement(o.Provider,{value:A},a.createElement(u,{forcedTheme:t,storageKey:i,attribute:p,enableSystem:n,enableColorScheme:c,defaultTheme:g,value:b,themes:d,nonce:k,scriptProps:v}),f)},u=a.memo(e=>{let{forcedTheme:t,storageKey:r,attribute:s,enableSystem:l,enableColorScheme:o,defaultTheme:c,value:i,themes:d,nonce:m,scriptProps:g}=e,u=JSON.stringify([s,r,c,t,d,i,l,o]).slice(1,-1);return a.createElement("script",{...g,suppressHydrationWarning:!0,nonce:"",dangerouslySetInnerHTML:{__html:"(".concat(n.toString(),")(").concat(u,")")}})}),h=(e,t)=>{let r;try{r=localStorage.getItem(e)||void 0}catch(e){}return r||t},x=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},y=e=>(e||(e=window.matchMedia(l)),e.matches?"dark":"light")},7427:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>k});var a=r(5155),n=r(2115);let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,n.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:i="",children:d,iconNode:m,...g}=e;return(0,n.createElement)("svg",{ref:t,...o,width:a,height:a,stroke:r,strokeWidth:c?24*Number(s)/Number(a):s,className:l("lucide",i),...g},[...m.map(e=>{let[t,r]=e;return(0,n.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),i=(e,t)=>{let r=(0,n.forwardRef)((r,a)=>{let{className:o,...i}=r;return(0,n.createElement)(c,{ref:a,iconNode:t,className:l("lucide-".concat(s(e)),o),...i})});return r.displayName="".concat(e),r},d=i("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),m=i("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),g=i("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),u=i("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var h=r(1362);let x=i("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),y=i("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),p=i("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function b(e){let{story:t,images:r=[],isGeneratingStory:n=!1,isGeneratingImages:s=!1,generationStatus:l="",expectedFrames:o}=e,c=null!=o?o:r.length>0?r.length:4,i=function(e,t){let r=Array.from({length:t},()=>""),a=(e||"").trim();if(!a)return r;if(a.includes("[SCENE 1]"))return a.split(/\[SCENE \d+\]/g).filter(Boolean).forEach((e,a)=>{a<t&&(r[a]=e.trim())}),r;console.warn("Story format doesn't contain [SCENE] markers. Falling back to paragraph splitting.");let n=a.split(/\n\s*\n+/).filter(Boolean);if(n.length>=t)return n.forEach((e,a)=>{a<t&&(r[a]=e.trim())}),r;let s=a.match(/[^.!?]+[.!?]+(?:\s+|$)/g)||[],l=Math.ceil(s.length/t);for(let e=0;e<t;e++)r[e]=s.slice(e*l,(e+1)*l).join(" ").trim();return r}(t,c),d=e=>{try{let t=e.gcs_url||"data:image/".concat(e.format,";base64,").concat(e.base64),r=window.open();r&&r.document.write('\n          <html>\n            <head><title>Story Frame</title></head>\n            <body style="margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh; background:#000;">\n              <img src="'.concat(t,'" style="max-width:100%; max-height:100%; object-fit:contain;" />\n            </body>\n          </html>\n        '))}catch(e){console.error("Error opening image:",e)}},m=(e,t)=>{try{if(e.gcs_url)window.open(e.gcs_url,"_blank");else if(e.base64){let r=document.createElement("a");r.href="data:image/".concat(e.format,";base64,").concat(e.base64),r.download="story-frame-".concat(t+1,".").concat(e.format),r.click()}}catch(e){console.error("Error downloading image:",e)}};return(0,a.jsxs)("div",{className:"w-full space-y-8",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Generated Story"}),(s||n||l)&&(0,a.jsx)("div",{className:"text-sm text-blue-600 dark:text-blue-400",children:l||(s?"Generating images…":n?"Generating story…":"")})]}),Array.from({length:c}).map((e,t)=>{let l=r[t],o=i[t];return(0,a.jsx)("div",{className:"bg-orange-100/70 dark:bg-orange-900/20 rounded-2xl p-4 md:p-6 shadow-sm",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6",children:[(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4 md:p-5",children:o?(0,a.jsx)("div",{className:"text-gray-800 dark:text-gray-200 whitespace-pre-wrap leading-relaxed",children:o}):(0,a.jsx)("div",{className:"h-full flex items-center justify-center text-gray-500 dark:text-gray-400",children:n?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(x,{className:"h-5 w-5 animate-spin"})," Generating story…"]}):(0,a.jsxs)("span",{className:"italic",children:["Story frame ",t+1," will appear here…"]})})}),(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-2 md:p-3 relative min-h-[180px] md:min-h-[220px]",children:l?l.placeholder||l.error?(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center rounded-lg bg-gray-200 dark:bg-gray-700",children:(0,a.jsxs)("div",{className:"text-center p-4",children:[(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm block mb-2",children:"Image generation failed"}),(0,a.jsxs)("span",{className:"text-gray-400 dark:text-gray-500 text-xs",children:["Frame ",t+1]})]})}):(0,a.jsxs)("div",{className:"group relative h-full w-full overflow-hidden rounded-lg",children:[(0,a.jsx)("img",{src:l.gcs_url&&!l.gcs_error?l.gcs_url:l.base64?"data:image/".concat(l.format,";base64,").concat(l.base64):"",alt:"Story image ".concat(t+1),className:"h-full w-full object-cover",onError:e=>{l.gcs_url&&l.base64&&(console.log("GCS URL failed for image ".concat(t+1,", falling back to base64")),e.target.src="data:image/".concat(l.format,";base64,").concat(l.base64),l.gcs_error=!0)}}),(0,a.jsxs)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-opacity opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>d(l),className:"p-2 bg-white/20 hover:bg-white/30 rounded-full",title:"View full size",children:(0,a.jsx)(y,{className:"h-4 w-4 text-white"})}),(0,a.jsx)("button",{onClick:()=>m(l,t),className:"p-2 bg-white/20 hover:bg-white/30 rounded-full",title:"Download image",children:(0,a.jsx)(p,{className:"h-4 w-4 text-white"})})]})]}):(0,a.jsx)("div",{className:"h-full w-full flex items-center justify-center rounded-lg bg-gray-200 dark:bg-gray-700",children:s?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[(0,a.jsx)(x,{className:"h-5 w-5 animate-spin"})," Generating image…"]}):(0,a.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:["Image ",t+1]})})})]})},t)})]})}var f=r(9509);function k(){let[e,t]=(0,n.useState)(!1),{theme:r,setTheme:s}=(0,h.D)(),[l,o]=(0,n.useState)(""),[c,i]=(0,n.useState)(!1),[x,y]=(0,n.useState)(null),[p,k]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!1),[N,j]=(0,n.useState)(""),[S,E]=(0,n.useState)(!1),[C,_]=(0,n.useState)(null),[M,A]=(0,n.useState)([]),[T,G]=(0,n.useState)(!1),[L,W]=(0,n.useState)(""),I=(0,n.useRef)(null),R=(0,n.useRef)(null),O=(0,n.useRef)(Math.random().toString(36).substring(7)),F=(0,n.useCallback)(()=>{var e;if((null===(e=I.current)||void 0===e?void 0:e.readyState)!==WebSocket.OPEN){w(!0),_(null);try{let e=f.env.NEXT_PUBLIC_BACKEND_URL||"ws://localhost:8000",t="".concat(e,"/ws/").concat(O.current);console.log("Connecting to WebSocket at: ".concat(t));let r=new WebSocket(t);r.onopen=()=>{console.log("WebSocket connected"),k(!0),w(!1),_(null),R.current&&(clearTimeout(R.current),R.current=null)},r.onmessage=e=>{try{var t,r;let a=JSON.parse(e.data);switch(console.log("Received message:",a),a.type){case"connected":console.log("Backend connection confirmed");break;case"processing":E(!0),W(a.message||"Generating...");break;case"story_chunk":a.data&&(a.partial?j(e=>e+a.data):j(e=>e+a.data));break;case"story_complete":a.data&&(j(a.data),console.log("Complete story received:",a.data.length,"characters"));break;case"tool_call":"generate_image"===a.tool_name&&(G(!0),W("Generating image: ".concat((null===(t=a.parameters)||void 0===t?void 0:t.prompt)||"Unknown prompt")),console.log("Image generation started:",a.parameters));break;case"image_generated":try{let e=a.data;if(e&&Array.isArray(e.images))A(t=>[...t,...e.images]),W("Generated image batch"),console.log("Image batch received:",e);else if(e&&(e.gcs_url||e.base64)){let t={index:"number"==typeof e.index?e.index:M.length%4,format:e.format||"png",stored_in_bucket:null!==(r=e.stored_in_bucket)&&void 0!==r?r:!!e.gcs_url,...e.gcs_url?{gcs_url:e.gcs_url}:{},...e.base64?{base64:e.base64}:{}};A(e=>{let r=[...e];return r[t.index]=t,r}),W("Generated image ".concat(t.index+1," of 4")),console.log("Single image received:",t)}else console.warn("Unknown image payload shape:",e)}catch(e){console.error("Error processing image data:",e),W("Error processing generated image")}break;case"turn_complete":a.turn_complete&&(E(!1),G(!1),W(""),console.log("Story and image generation completed"));break;case"error":console.error("Server error:",a.message),_(a.message||"Server error occurred"),E(!1),G(!1),W("");break;case"pong":break;default:console.log("Unknown message type:",a.type)}}catch(e){console.error("Error parsing WebSocket message:",e)}},r.onclose=e=>{console.log("WebSocket disconnected:",e.code,e.reason),k(!1),w(!1),E(!1),G(!1),W(""),1e3===e.code||R.current||(R.current=setTimeout(()=>{console.log("Attempting to reconnect..."),F()},3e3))},r.onerror=e=>{console.error("WebSocket error:",e),_("Failed to connect to story generation service"),w(!1),E(!1),G(!1),W("")},I.current=r}catch(e){console.error("Error creating WebSocket:",e),_("Failed to create connection"),w(!1)}}},[]),P=(0,n.useCallback)(e=>{var t;return(null===(t=I.current)||void 0===t?void 0:t.readyState)===WebSocket.OPEN?(I.current.send(JSON.stringify(e)),!0):(console.error("WebSocket not connected"),_("Not connected to story service"),!1)},[]);(0,n.useEffect)(()=>(F(),()=>{R.current&&clearTimeout(R.current),I.current&&I.current.close(1e3,"Component unmounting")}),[F]),(0,n.useEffect)(()=>{if("webkitSpeechRecognition"in window){let e=new(window.webkitSpeechRecognition||window.SpeechRecognition);e.continuous=!1,e.interimResults=!1,e.lang="en-US",e.onstart=()=>{i(!0)},e.onresult=e=>{let t=e.results[0][0].transcript;o(e=>e+(e?" ":"")+t)},e.onend=()=>{i(!1)},e.onerror=e=>{console.error("Speech recognition error:",e.error),i(!1)},y(e)}},[]);let z=()=>{if(!l.trim()){alert("Please enter some keywords first!");return}if(!p){_("Not connected to story service. Attempting to reconnect..."),F();return}j(""),A([]),E(!0),G(!1),W(""),t(!0),_(null),A([,,,,].fill(null)),P({type:"generate_story",data:l.trim()})||E(!1)};return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col items-center px-4 py-8 md:py-16",children:[(0,a.jsxs)("div",{className:"absolute top-4 right-4 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full bg-gray-100 dark:bg-gray-800 text-sm",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-yellow-600 dark:text-yellow-400",children:"Connecting..."})]}):p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-green-600 dark:text-green-400",children:"Connected"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,a.jsx)("span",{className:"text-red-600 dark:text-red-400",children:"Disconnected"})]})}),(0,a.jsx)("button",{onClick:()=>s("dark"===r?"light":"dark"),className:"p-2 rounded-full bg-gray-100 dark:bg-gray-800 transition-colors","aria-label":"Toggle theme",children:"dark"===r?(0,a.jsx)(d,{className:"h-5 w-5 text-yellow-500"}):(0,a.jsx)(m,{className:"h-5 w-5 text-gray-700"})})]}),(0,a.jsxs)("div",{className:"w-full max-w-3xl mx-auto text-center space-y-8 mb-12",children:[(0,a.jsx)("h1",{className:"text-4xl md:text-5xl font-bold tracking-tight text-gray-900 dark:text-white",children:"StoryGen"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Enter keywords to generate a captivating story with AI-generated visuals"}),C&&(0,a.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"text-red-600 dark:text-red-400 text-sm",children:C}),(0,a.jsx)("button",{onClick:F,className:"mt-2 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-sm font-medium",children:"Try reconnecting"})]}),(T||L)&&(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:(0,a.jsx)("p",{className:"text-blue-600 dark:text-blue-400 text-sm",children:L||"Generating images..."})}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-3 w-full max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{type:"text",value:l,onChange:e=>o(e.target.value),placeholder:"Enter keywords (e.g., hacker, AI, future)",className:"w-full px-6 py-4 pr-14 text-lg rounded-2xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 dark:text-white",disabled:S,onKeyPress:e=>{"Enter"!==e.key||S||z()}}),(0,a.jsx)("button",{onClick:()=>{if(!x){alert("Speech recognition is not supported in your browser");return}c?x.stop():x.start()},disabled:S,className:"absolute right-3 top-1/2 transform -translate-y-1/2 p-2 rounded-full transition-colors ".concat(c?"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-400":"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"," ").concat(S?"opacity-50 cursor-not-allowed":""),"aria-label":c?"Stop recording":"Start voice input",children:c?(0,a.jsx)(g,{className:"h-5 w-5"}):(0,a.jsx)(u,{className:"h-5 w-5"})})]}),(0,a.jsx)("button",{onClick:z,disabled:S||!p||!l.trim(),className:"px-8 py-4 text-lg font-medium text-white bg-purple-600 rounded-2xl hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Generating...":"Generate Story"})]})]}),e&&(0,a.jsx)("div",{className:"w-full max-w-5xl mx-auto space-y-12 animate-fade-in",children:(0,a.jsx)(b,{story:N,images:M,isGeneratingStory:S,isGeneratingImages:T,generationStatus:L,expectedFrames:4})})]})}},9038:(e,t,r)=>{Promise.resolve().then(r.bind(r,7427))}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(9038)),_N_E=e.O()}]);